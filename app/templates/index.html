{% extends "base.html" %}
{% block content %}
<div id="page" class="max-w-2xl mx-auto">
  <div class="flex justify-between items-center mb-3">
    <button id="settings-toggle" class="px-2 py-1 text-base rounded-md">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
    <path d="M3 12h18M3 6h18M3 18h18" stroke-width="2"/>
  </svg>
    </button>
    <h1 class="text-xl">Blood Pressure and Pulse</h1>
  </div>
  <div id="settings-panel" class="hidden mt-2 p-2 border border-gray-300 rounded-md mb-2">
    <form id="settings-form" hx-post="/update_chart" hx-target="#charts" hx-swap="outerHTML" hx-trigger="change">
      <label class="flex items-center gap-2">
        <input type="checkbox" name="filter" value="me_only" class="toggle-checkbox" />
        <span>Plot only morning/evening measurements</span>
      </label>
      <label class="flex items-center gap-2">
        <input type="checkbox" name="night_shadows" value="true" class="toggle-checkbox" />
        <span>Night shadows</span>
      </label>
    </form>
  </div>

  <form id="entry-form" class="flex gap-2 flex-wrap mb-2"
        action="/add" method="post"
        hx-post="/add" hx-target="#page" hx-swap="outerHTML" hx-disabled-elt="button">
    <input name="line" type="text" class="flex-1 min-w-[220px] px-2 py-1 text-base border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="e.g.: 120 80 56 125 85 60" inputmode="numeric" value="{{ input_value or '' }}" />
    <button type="submit" class="px-3 py-1 text-base bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:ring-2 focus:ring-blue-500 px-4 py-2">Save</button>
  </form>

  <!--div class="min-h-[1.2em] text-gray-600 mb-1.5">{{ status_msg or "" }}</div-->
  <div class="text-sm text-gray-600 mb-3">Records: {{ entries_count }}</div>

  <div id="charts" class="flex flex-col gap-3">
    <img class="w-full h-auto" alt="Blood Pressure and Pulse" src="/chart/combined.png?cb={{ cache_bust }}" />
  </div>

  <div>
    <h2 class="text-center">Daily measurements</h2>
    <div class="overflow-x-auto">
      <table class="w-auto border-collapse border border-gray-300 mx-auto mt-3 rounded-none overflow-hidden shadow-lg">
      <thead>
        <tr>
          <th rowspan="2" class="border border-gray-300 px-1 py-1 text-center text-sm bg-gray-300 font-semibold text-gray-800 sm:px-2.5 sm:py-1.5">Date</th>
          <th colspan="2" class="border border-gray-300 px-1 py-1 text-center text-sm bg-gray-300 font-semibold text-gray-800 sm:px-2.5 sm:py-1.5">Morning</th>
          <th colspan="2" class="border border-gray-300 px-1 py-1 text-center text-sm bg-gray-300 font-semibold text-gray-800 sm:px-2.5 sm:py-1.5">Evening</th>
        </tr>
        <tr>
          <th class="border border-gray-300 px-1 py-1 text-center text-sm bg-gray-300 font-semibold text-gray-800 sm:px-2.5 sm:py-1.5">Pressure</th>
          <th class="border border-gray-300 px-1 py-1 text-center text-sm bg-gray-300 font-semibold text-gray-800 sm:px-2.5 sm:py-1.5">Pulse</th>
          <th class="border border-gray-300 px-1 py-1 text-center text-sm bg-gray-300 font-semibold text-gray-800 sm:px-2.5 sm:py-1.5">Pressure</th>
          <th class="border border-gray-300 px-1 py-1 text-center text-sm bg-gray-300 font-semibold text-gray-800 sm:px-2.5 sm:py-1.5">Pulse</th>
        </tr>
      </thead>
      <tbody>
        {% for day in grouped_data %}
        <tr class="even:bg-blue-50 hover:bg-gray-100 transition-colors duration-200">
          <td class="border border-gray-300 px-1 py-1 text-center text-sm sm:px-2.5 sm:py-1.5">{{ day.date }}</td>
          <td class="border border-gray-300 px-1 py-1 text-center text-sm sm:px-2.5 sm:py-1.5">{% if day.morning %}{{ day.morning.sys }} / {{ day.morning.dia }}{% endif %}</td>
          <td class="border border-gray-300 px-1 py-1 text-center text-sm sm:px-2.5 sm:py-1.5">{% if day.morning %}{{ day.morning.pulse }}{% endif %}</td>
          <td class="border border-gray-300 px-1 py-1 text-center text-sm sm:px-2.5 sm:py-1.5">{% if day.evening %}{{ day.evening.sys }} / {{ day.evening.dia }}{% endif %}</td>
          <td class="border border-gray-300 px-1 py-1 text-center text-sm sm:px-2.5 sm:py-1.5">{% if day.evening %}{{ day.evening.pulse }}{% endif %}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    </div>
  </div>
</div>
<script>
  document.getElementById('settings-toggle').addEventListener('click', function() {
    const panel = document.getElementById('settings-panel');
    panel.classList.toggle('hidden');
  });
</script>
{% endblock %}

